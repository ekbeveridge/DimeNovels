# things to have installed
- ubuntu
- python
- internet archive 
- ocaml
wsl --install

sudo apt update
sudo apt install pythonpy
sudo apt install internetarchive
ia configure
sudo apt install python3-pip
pip3 install internetarchive pandas xlrd



# Setting Up:
The short version of things you will need to install:
- Command line interface (such as Windows Terminal, which can be installed from the Microsoft Store)
- WSL & Ubuntu
- Python
- Internet Archive's command line tool

If you're not already on a Linux machine, you'll have to install Ubuntu.

On Windows, you can do this in the default command line interface with `wsl --install`. Reboot the machine and open it in your preferred command line interface. You may need to enable virtualization in order for Ubuntu to properly install-- the steps for this will depend on your machine.

Now that Ubuntu is set up, install the packages needed to run the program. First, run `sudo apt update` to update the existing packages. Then run `sudo apt install pythonpy python3-pip internetarchive` this includes python (which is required to run the program), pip (which is used to install other dependencies), and the Internet Archive command line tool itself. Then run `pip3 install pandas xlrd`. Pandas and `xlrd` are used for reading the metadata Excel spreadsheets.

Next, set up the IA credentials with `ia configure`. See the [IA Quickstart guide](https://archive.org/services/docs/api/internetarchive/quickstart.html) for more information.

Once you have this, you should be good to start! 

## Google Drive Backup
You can install this one of two ways:
`sudo add-apt-repository ppa:alessandro-strada/ppa`
`sudo apt update && sudo apt install google-drive-ocamlfuse`

Or this version, which worked for previous techs:
`sudo apt install opam`
`opam init`
`opam update`
`opam switch create 4.08.0`
`opam install google-drive-ocamlfuse`

However, I have not gotten it to work on Windows.

If all else fails, the images can be downloaded manually.





# Dependencies

Internet Archive's Python library is available as a [Pypi package](https://pypi.org/project/internetarchive/).
As such, it's installable using [Pip](https://pip.pypa.io/en/stable/installing/).

We also need Pandas and `xlrd` for reading Excel spreadsheets. In Python 3, the following command should install everything that's needed:

	pip3 install internetarchive pandas xlrd

If CSV spreadsheets were used instead, Pandas and `xlrd` could be replaced with the built-in [`csv`](https://docs.python.org/3.5/library/csv.html) module.

# Credentials

You'll need IA credentials to upload. The program expects to find these in `config.ini` in the directory it's run from.
See the [IA Quickstart guide](https://archive.org/services/docs/api/internetarchive/quickstart.html) for how to populate this file.

# Uploading `texts` items

For items with media type `texts`, the archive displays a pager on the item's webpage that allows the visitor to read through the text.
In order for this to work, the system has to be able to tell what files are the page scans, and which corresponds to which page.
I don't completely understand how this detection works (it seems undocumented), but I found that the following works:

Combine the scan image files into a ZIP file.
If the IA identifier for an item to be uploaded is `xyz`, then I know it's acceptable for the ZIP file to contain a single folder called `xyz` containing image files whose names are `xyz` followed by a number specifying the order of pages.
For example, the first scan could be `xyz00010.jpg`, and the second `xyz00020.jpg`.
It's possible that some of these constraints can be relaxed, but I'm not certain.

The ZIP file must then be uploaded as `xyz_images.zip` in order to be recognized as containing the page scans.
This is the only file that needs to be uploaded to get the basic features of the `texts` media type.
Other derived files/features including OCR are generated by the Internet Archive after uploading.

# Metadata

I had some trouble when accidentally trying to include metadata keys with leading whitespace.
It's probably best to strip whitespace from keys to be safe (my program does this).

# Testing

I used the Internet Archive `test_collection` collection to upload temporary (test) items.
Items uploaded to the test collection only stay around for about a month.
The collection to upload to is specified using the `collection` metadata key.

# The program

My program expects the input to be mounted at the path specified in the `base_dir` variable.
I made a shell script `mount.sh` that mounts the storage on `mnt`, and I set the `base_dir` to point to `mnt`, so that from the `code` directory I run `sudo sh mount.sh` to mount the storage if necessary, and then `python3 process.py` to run the script. This depends on "google drive ocamlfuse". On arch linux, this can be installed from the AUR with the package `google-drive-ocamlfuse-opam`. The `google-drive-ocamlfuse` package may also work, but did not work for me. 
If the storage is mounted a different way (e.g. using the system file browser), it's probably easiest to change `base_dir` to that location.
You'll have to find out then where the system mounted the storage.

As far as I know, the program should work equally well on Linux, MacOS, and Windows.
Only the mount script is specific to linux. 

# Resources

- [Documentation](https://archive.org/services/docs/api/internetarchive/index.html) for the Internet Archive Python library
- [Documentation](https://archive.org/services/docs/api/metadata-schema/index.html) for IA item metadata
